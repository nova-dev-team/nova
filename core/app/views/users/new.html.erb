<html>
<%
  groups = ""
  Group.all.each {|g| groups += "'#{g.name}',"}
  rindex = groups.rindex ','
  if rindex
    groups = groups[0...rindex]
  end
%>
<head>
<%= javascript_include_tag "prototype" %>
<script type="text/javascript">
  var groups = [<%= groups %>];

  function do_submit() {
    var g_choices = "";
    for (i = 0; i < groups.length; i++) {
      var g_chkbox = $("group_choice_" + groups[i]);
      if (g_chkbox.checked) {
        g_choices += groups[i] + "\n";
      }
    }
    $("user_groups").value = g_choices;
    $("login_form").submit();
  }

  window.onload = function() {
    var g_div = $("group_choices");

    function write_choice(g_name) {
      g_div.innerHTML += "<input type='checkbox' id='group_choice_" + g_name +"'>" + g_name + "</input><br>";
    }

    for (i = 0; i < groups.length; i++) {
      write_choice(groups[i]);
    }
  }
</script>
</head>
<body>
<h1>Sign up as a new user</h1>
<% @user.password = @user.password_confirmation = nil %>

<%= error_messages_for :user %>
<% form_for :user, :url => users_path, :html => {:id => "login_form"} do |f| -%>
<p><%= label_tag 'login' %><br/>
<%= f.text_field :login %></p>

<p><%= label_tag 'email' %><br/>
<%= f.text_field :email %></p>

<p><%= label_tag 'password' %><br/>
<%= f.password_field :password %></p>

<p><%= label_tag 'password_confirmation', 'Confirm Password' %><br/>
<%= f.password_field :password_confirmation %></p>

<p>Apply for groups:</p>

<div id="group_choices"></div>

<input type="hidden" id="user_groups" name="user[groups]" value=""></input>

<p><a href="#" onclick="do_submit(); return false">Sign Up</a></p>

<% end -%>
</body></html>
