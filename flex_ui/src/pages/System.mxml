<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" xmlns:settings="services.settings.*">
	<mx:Script>
		<![CDATA[
			import com.adobe.serialization.json.JSON;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			
			import nova.GlobalConst;
			
			[Bindable]
			protected var settingsListData:ArrayCollection = new ArrayCollection();
			
			protected function sys_setting_creationCompleteHandler(event:FlexEvent):void
			{
				list_settings_Request.send();
			}
			
			protected function listSettingsHandle(e:ResultEvent):void {
				var ret:Object = JSON.decode(e.message.body.toString());
				if (ret.success) {
					settingsListData.removeAll();
					for (var i:Number = 0; i < ret.data.length; i++) {
						settingsListData.addItem(ret.data[i]);
					}
				} else {
					Alert.show("Failed to retrieve list of settings!");	
				}
			}
			

			protected function refresh_btn_clickHandler(event:MouseEvent):void
			{
				list_settings_Request.send();
			}

		]]>
	</mx:Script>
	<mx:Accordion x="0" y="0" width="100%" height="100%">
		<mx:Canvas label="System settings" width="100%" height="100%">
			<mx:AdvancedDataGrid x="20" y="62" id="sys_setting" designViewDataType="flat" width="996" height="286" creationComplete="sys_setting_creationCompleteHandler(event)" dataProvider="{settingsListData}">
				<mx:columns>
					<mx:AdvancedDataGridColumn headerText="Key" dataField="key"/>
					<mx:AdvancedDataGridColumn headerText="Value" dataField="value"/>
					<mx:AdvancedDataGridColumn headerText="Information" dataField="info"/>
					<mx:AdvancedDataGridColumn dataField="for_worker" headerText="For worker?"/>
				</mx:columns>
			</mx:AdvancedDataGrid>
			<mx:Button x="20" y="32" label="Refresh" id="refresh_btn" click="refresh_btn_clickHandler(event)"/>
		</mx:Canvas>
		<mx:Canvas label="Worker machines" width="100%" height="100%">
			<mx:AdvancedDataGrid x="10" y="10" id="worker_machines" designViewDataType="flat" width="971" height="303">
				<mx:columns>
					<mx:AdvancedDataGridColumn headerText="IP" dataField="ip"/>
					<mx:AdvancedDataGridColumn headerText="Hostname" dataField="hostname"/>
					<mx:AdvancedDataGridColumn headerText="Status" dataField="status"/>
					<mx:AdvancedDataGridColumn dataField="vm_capacity" headerText="VM capacity"/>
					<mx:AdvancedDataGridColumn dataField="vm_preparing" headerText="VM preparing"/>
					<mx:AdvancedDataGridColumn dataField="vm_running" headerText="VM running"/>
					<mx:AdvancedDataGridColumn dataField="vm_failure" headerText="VM failure"/>
					<mx:AdvancedDataGridColumn headerText="Actions"/>
				</mx:columns>
			</mx:AdvancedDataGrid>
			<mx:Button x="491" y="343" label="Add new worker"/>
			<mx:Button x="910" y="343" label="Refresh" id="pm_refresh_btn"/>
			<mx:TextInput x="80" y="342"/>
			<mx:TextInput x="323" y="343"/>
			<mx:Label x="11" y="344" text="Worker IP:"/>
			<mx:Label x="248" y="344" text="VM capacity:"/>
		</mx:Canvas>
		<mx:Canvas label="Port mappings" width="100%" height="100%">
			<mx:Button x="856" y="301" label="Button"/>
			<mx:AdvancedDataGrid x="19" y="23" id="port_mappings" designViewDataType="flat" width="1003" height="256">
				<mx:columns>
					<mx:AdvancedDataGridColumn headerText="Proxy port" dataField="proxy_port"/>
					<mx:AdvancedDataGridColumn headerText="Destination IP" dataField="ip"/>
					<mx:AdvancedDataGridColumn dataField="dest_port" headerText="Destination port"/>
				</mx:columns>
			</mx:AdvancedDataGrid>
			<mx:TextInput x="94" y="304" width="147"/>
			<mx:TextInput x="384" y="301"/>
			<mx:Label x="286" y="305" text="Destination IP:"/>
			<mx:Label x="19" y="307" text="Proxy port:"/>
			<mx:TextInput x="681" y="301"/>
			<mx:Label x="565" y="308" text="Destination port:"/>
		</mx:Canvas>
		<mx:Canvas label="Storage server" width="100%" height="100%">
		</mx:Canvas>
		<mx:Canvas label="Software packages" width="100%" height="100%">
			<mx:AdvancedDataGrid x="25" y="25" id="soft_package" designViewDataType="flat" width="974" height="198">
				<mx:columns>
					<mx:AdvancedDataGridColumn headerText="Display name" dataField="display_name"/>
					<mx:AdvancedDataGridColumn headerText="File name" dataField="filename"/>
					<mx:AdvancedDataGridColumn headerText="OS family" dataField="os_family"/>
					<mx:AdvancedDataGridColumn dataField="description" headerText="Description"/>
					<mx:AdvancedDataGridColumn headerText="Actions"/>
				</mx:columns>
			</mx:AdvancedDataGrid>
			<mx:Button x="659" y="293" label="Register software"/>
			<mx:Label x="27" y="266" text="Display name:"/>
			<mx:Label x="27" y="238" text="You can register new software packages. Make sure you have uploaded software packages to storage server first."/>
			<mx:TextInput x="122" y="266"/>
			<mx:Label x="316" y="266" text="Filename:"/>
			<mx:TextInput x="411" y="266"/>
			<mx:Label x="27" y="294" text="Description"/>
			<mx:TextInput x="122" y="294" width="449"/>
			<mx:Label x="606" y="266" text="OS family:"/>
			<mx:ComboBox x="674" y="266" editable="false"></mx:ComboBox>
		</mx:Canvas>
		<mx:Canvas label="Vdisk images" width="100%" height="100%">
			<mx:AdvancedDataGrid x="26" y="19" id="vdisk_images" designViewDataType="flat" width="974" height="185">
				<mx:columns>
					<mx:AdvancedDataGridColumn headerText="Display name" dataField="display_name"/>
					<mx:AdvancedDataGridColumn headerText="File name" dataField="filename"/>
					<mx:AdvancedDataGridColumn headerText="OS family" dataField="os_family"/>
					<mx:AdvancedDataGridColumn dataField="description" headerText="Description"/>
					<mx:AdvancedDataGridColumn headerText="Actions"/>
				</mx:columns>
			</mx:AdvancedDataGrid>
			<mx:Button x="893" y="284" label="Register vdisk"/>
			<mx:Label x="31" y="258" text="Display name:"/>
			<mx:Label x="31" y="230" text="You can register new vdisk images. Make sure you have uploaded vdisk images to storage server first."/>
			<mx:TextInput x="126" y="258"/>
			<mx:Label x="31" y="283" text="OS name:"/>
			<mx:TextInput x="126" y="286"/>
			<mx:Label x="320" y="258" text="Filename:"/>
			<mx:TextInput x="415" y="258"/>
			<mx:Label x="324" y="286" text="Description:"/>
			<mx:TextInput x="402" y="284" width="449"/>
			<mx:Label x="610" y="258" text="Image type:"/>
			<mx:ComboBox x="691" y="257" editable="false" width="111"></mx:ComboBox>
			<mx:Label x="825" y="257" text="OS family:"/>
			<mx:ComboBox x="893" y="257" editable="false" width="100"></mx:ComboBox>
		</mx:Canvas>
	</mx:Accordion>
	
	<mx:HTTPService id="list_settings_Request" url="{GlobalConst.settings_list}" useProxy="false" method="POST" resultFormat="text" result="listSettingsHandle(event);" showBusyCursor="true" />
	
</mx:Canvas>
