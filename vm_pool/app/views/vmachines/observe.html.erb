<%
require "yaml"

vm_name = params[:id]
conf = YAML::load File.read "#{RAILS_ROOT}/../common/config/conf.yml"
vnc_port = conf["vm_vnc_port"]
%>
<html>
<head>
<script type="text/javascript" src="/javascripts/deployJava.js">
</script>
<title>VNC on <%= vm_name %></title>
</head>
<body>
<%=
begin
<<VNC
<div id="check_java"></div>
<script type="text/javascript">
deployJava.do_initialize();
var java_message = "Displaying VM screen requires Java 6 or higher. Get it from www.java.com!"
function check_java_installed() {
  if (deployJava.versionCheck("1.6") == false) {
    if (document.all) {
      check_java.innnerHTML = java_message;
    } else if (document.getElementById) {
      rng = document.createRange();
      el = document.getElementById("check_java");
      rng.setStartBefore(el);
      htmlFrag = rng.createContexualFragment(java_message);
      while (e1.hasChildNodes()) {
        el.removeChild(el.lastChild);
      }
      el.appendChild(htmlFrag);
    }
  }
}
window.onload = check_java_installed;
</script>
<applet code="VncViewer.class" archive="/vncviewer.jar" width="1280" height="840">
  <param name="port" value="#{vnc_port}">
  <param name="password" value="#{vm_name[4..-1]}">
</applet>
VNC
rescue
"<font color='red'>Error occured, please check your parameter!</font>"
end
%>
</body>
</html>
